From 7c2f68a4bfc5571951fc27d686cb9f9b3820ecf1 Mon Sep 17 00:00:00 2001
From: Sagar Shah <schshah@cs.stonybrook.edu>
Date: Wed, 15 Mar 2017 16:31:38 -0400
Subject: [PATCH 1/3] Construct page table in system.cpp: part 1

---
 system.h | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/system.h b/system.h
index b2a7b13..628f63b 100644
--- a/system.h
+++ b/system.h
@@ -11,6 +11,10 @@
 #define MEGA (1024UL*1024)
 #define GIGA (1024UL*1024*1024)
 
+#define PAGE_SIZE 	(1024UL*4)
+#define VALID_PAGE_DIR 	(0b0000000011)
+#define VALID_PAGE 	(0b0000000001)
+
 typedef unsigned long __uint64_t;
 typedef __uint64_t uint64_t;
 typedef unsigned int __uint32_t;
@@ -30,6 +34,7 @@ class System {
     char* ram;
     unsigned int ramsize;
     uint64_t max_elf_addr;
+    bitset<GIGA/PAGE_SIZE> memmap;
 
     enum { IRQ_TIMER=0, IRQ_KBD=1 };
     int interrupts;
@@ -46,6 +51,12 @@ class System {
 
     void dram_read_complete(unsigned id, uint64_t address, uint64_t clock_cycle);
     void dram_write_complete(unsigned id, uint64_t address, uint64_t clock_cycle);
+    uint64_t get_random_page();
+    void init_page_table(uint64_t table_addr);
+    uint64_t get_new_pte(uint64_t base_addr, int vpn, bool isleaf);
+    uint64_t get_old_pte(uint64_t base_addr, int vpn);
+    uint64_t virt_to_new_phy(uint64_t virt_addr);
+
     DRAMSim::MultiChannelMemorySystem* dramsim;
     
 public:
-- 
2.7.4


From 5434f37df5e95b6cf9f473772fee0ec53615a554 Mon Sep 17 00:00:00 2001
From: Sagar Shah <schshah@cs.stonybrook.edu>
Date: Wed, 15 Mar 2017 17:15:33 -0400
Subject: [PATCH 2/3] Construct page table in system.cpp: part 2

---
 system.h | 1 +
 1 file changed, 1 insertion(+)

diff --git a/system.h b/system.h
index 628f63b..1614aaf 100644
--- a/system.h
+++ b/system.h
@@ -4,6 +4,7 @@
 #include <map>
 #include <list>
 #include <queue>
+#include <bitset>
 #include "DRAMSim2/DRAMSim.h"
 #include "Vtop.h"
 
-- 
2.7.4


From fdac5154b2a6e0ad91d94e9e418aa94d68d208d5 Mon Sep 17 00:00:00 2001
From: Sagar Shah <schshah@cs.stonybrook.edu>
Date: Wed, 15 Mar 2017 17:46:06 -0400
Subject: [PATCH 3/3] Contruction page tables: part 3

---
 system.h | 1 +
 1 file changed, 1 insertion(+)

diff --git a/system.h b/system.h
index 1614aaf..a6d4020 100644
--- a/system.h
+++ b/system.h
@@ -57,6 +57,7 @@ class System {
     uint64_t get_new_pte(uint64_t base_addr, int vpn, bool isleaf);
     uint64_t get_old_pte(uint64_t base_addr, int vpn);
     uint64_t virt_to_new_phy(uint64_t virt_addr);
+    uint64_t virt_to_old_phy(uint64_t virt_addr);
 
     DRAMSim::MultiChannelMemorySystem* dramsim;
     
-- 
2.7.4

